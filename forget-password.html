<!DOCTYPE html>
<html lang="zh">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>忘记密码 - EasyAPI服务平台</title>
  <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://static.easyapi.com/styles/base.css" rel="stylesheet"/>
  <meta name="descriptions" content="用户忘记密码找回密码"/>
  <meta name="keywords" content="忘记密码,找回密码"/>
  <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body>
<div id="app">
  <div style="margin: 0 0 100px 0">
    <div class="toper">
      <div class="wp">
        <a href="https://www.easyapi.com/"><img class="logo pl" src="https://static.easyapi.com/images/logo.png"/></a>
        <div class="navs pr">
          <a href="./login.html">登录</a>
          <a href="./signup.html">注册</a>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt">
    <div class="lg-form">
      <div class="lg-title text-center">重置密码</div>
      <div class="lg-body bgf">
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px">
          <el-form-item label="" prop="username">
            <el-input placeholder="请输入手机号码" v-model="ruleForm.username" style="width: 350px;"></el-input>
          </el-form-item>
          <el-form-item label="" prop="code">
            <el-input placeholder="请输入验证码" v-model="ruleForm.code" style="width: 220px;"></el-input>
            <input type="button" id="sendCodeBtn" @click="sendCode" value="获取验证码"/>
          </el-form-item>
          <el-form-item label="" prop="password">
            <el-input placeholder="请输入新密码" type="password" v-model="ruleForm.password" style="width: 350px;"></el-input>
          </el-form-item>
          <el-form-item label="" prop="confirmPassword">
            <el-input placeholder="请再输入一次密码" type="password" v-model="ruleForm.confirmPassword"
                      style="width: 350px;"></el-input>
          </el-form-item>
          <input disabled id="btn_sub" type="button" @click="reset" class="btn-block btn btn-lg btn-info" value="确 定"/>
        </el-form>
      </div>
    </div>
  </div>

  <div class="foot clearfix">
    <p>
      <span>Copyright © 2015～2021 帮趣团队</span>
      <a href="https://www.easyapi.com/info/about" class="firstA">关于我们</a>
      <a href="https://www.easyapi.com/info/together">合作伙伴</a>
      <a href="https://www.easyapi.com/info/contact">联系我们</a>
      <a href="https://www.easyapi.com/info/donate">支持我们</a>
    </p>
  </div>
</div>
<script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.12/vue.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://static.easyapi.com/scripts/base.js"></script>
<script type="text/javascript">
  var vm = new Vue({
    el: '#app',
    data: {
      ruleForm: {
        username: '',
        code: '',
        password: '',
        confirmPassword: '',
      },
      rules: {
        username: [{
          required: true,
          message: '请输入手机号码',
          trigger: 'blur'
        },
          // {
          //   pattern: /^1[34578]\d{9}$/,
          //   message: '手机号码格式有误',
          //   trigger: 'change'
          // }
        ],
        code: [{
          required: true,
          message: '请输入验证码',
          trigger: 'blur'
        }],
        password: [{
          required: true,
          message: '密码6~16位之间，建议包含英文和标点符号',
          trigger: 'blur'
        },
          {
            min: 6,
            max: 16,
            message: '密码6~16位之间，建议包含英文和标点符号',
            trigger: 'change'
          }
        ],
        confirmPassword: [{
          required: true,
          message: '请再输入一次密码',
          trigger: 'blur'
        }],
      }
    },
    methods: {
      //确定
      reset() {
        let that = this
        let username = that.ruleForm.username
        let code = that.ruleForm.code
        let password = that.ruleForm.password
        let confirmPassword = that.ruleForm.confirmPassword
        if (password != confirmPassword) {
          that.$message.error('确认密码不一致');
        } else {
          $.ajax({
            method: 'POST',
            url: 'https://account-api.easyapi.com/api/account/forget-password/reset',
            contentType: 'application/json',
            data: JSON.stringify({
              username: that.ruleForm.username,
              code: that.ruleForm.code,
              password: that.ruleForm.password,
              confirmPassword: that.ruleForm.confirmPassword
            }),
            dataType: "json",
            success: function (res) {
              if (res.code == 1) {
                that.$message({
                  message: res.message,
                  type: 'success'
                });
                setTimeout(() => {
                  window.location.replace('login.html');
                }, 1000);
              } else {
                that.$message.error(res.message);
              }
            },
            error: function (res) {
              that.$message.error(res.responseJSON.message);
            }
          });
        }
      },
      //发送验证码
      sendCode() {
        let that = this
        let timer
        let telStr = /^1[34578]\d{9}$/
        if (telStr.test(that.ruleForm.username)) {
          $.ajax({
            url: "https://account-api.easyapi.com/api/captcha/send",
            method: "POST",
            contentType: 'application/json',
            data: JSON.stringify({
              mobile: that.ruleForm.username
            }),
            success: function (res) {
              if (res.code == 1) {
                that.$message({
                  message: res.message,
                  type: 'success'
                });
              } else {
                that.$message.error(res.message);
              }
            },
            error: function (res) {
              that.$message.error(res.message);
            }
          });
          let btn = $("#sendCodeBtn")
          let second = 60;
          btn.attr('disabled', true).addClass('disabled');
          timer = setInterval(() => {
            second--;
            if (second == 0) {
              btn.val('获取验证码');
              btn.attr('disabled', false).removeClass('disabled');
              clearInterval(timer)
              return
            }
            btn.val(`剩余${second}秒`);
          }, 1000)
        } else {
          that.$message.error('请输入正确的手机号码');
        }

      }
    },
    updated() {
      // 校验
      if (this.ruleForm.username != '' && this.ruleForm.code != '' && this.ruleForm.password.length >= 6 &&
        this.ruleForm.confirmPassword.length >= 6) {
        $('#btn_sub').removeAttr("disabled");
      } else {
        $('#btn_sub').attr("disabled", true);
      }
      //校验手机号版本
      /* let telStr = /^1[34578]\d{9}$/
      if (telStr.test(this.ruleForm.username) && this.ruleForm.code != '' && this.ruleForm.password.length >= 6 && this.ruleForm.confirmPassword.length >= 6) {
        $('#btn_sub').removeAttr("disabled");
      } else {
        $('#btn_sub').attr("disabled", true);
      } */
    }
  })
</script>
</body>

</html>
