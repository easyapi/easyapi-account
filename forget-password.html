<!DOCTYPE html>
<html lang="zh">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>忘记密码 - EasyAPI服务平台</title>
  <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://static.easyapi.com/styles/base.css" rel="stylesheet"/>
  <meta name="descriptions" content="用户忘记密码找回密码"/>
  <meta name="keywords" content="忘记密码,找回密码"/>
  <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <style>
    .flex {
      display: flex;
      justify-content: space-between;
    }

    .flex > input {
      width: 220px;
    }

    .flex > button {
      background: transparent;
      border: 1px solid #ced4da;
      outline: none;
      height: 47px;
      border-radius: .25rem;
      font-size: 14px;
      width: 120px;
    }

    #btn_sub {
      cursor: pointer;
    }

    .disabled {
      cursor: no-drop;
    }

    .distance {
      height: 20px;
    }
  </style>
</head>

<body>
<div style="margin: 0 0 100px 0">
  <div class="toper">
    <div class="wp">
      <a href="https://www.easyapi.com/"><img class="logo pl" src="https://static.easyapi.com/images/logo.png"/></a>
      <div class="navs pr">
        <a href="./login.html">登录</a>
        <a href="./signup.html">注册</a>
      </div>
    </div>
  </div>
</div>

<div class="container mt">
  <div class="lg-form">
    <div class="lg-title text-center">重置密码</div>
    <div class="lg-body bgf">
      <br/>
      <div class="form-group">
        <input id="username" datatype="m" nullmsg="请输入手机号码！" errormsg="手机号码格式有误！" name="user.username" type="text"
               size="20" class="form-control" alt="用户名" placeholder="请输入手机号码" validate="['required']">
      </div>
      <div class="form-group flex">
        <input id="code" datatype="s" nullmsg="请输入验证码！" name="user.code" type="text" size="20" class="form-control"
               alt="验证码" placeholder="验证码" validate="['required']">
        <button id="sendCodeBtn" onclick="sendCode()">获取验证码</button>
      </div>
      <div class="form-group">
        <input id="password" name="user.password" type="password" size="20" class="form-control" alt="登录密码"
               datatype="*6-16" nullmsg="请设置密码！" errormsg="密码范围在6~16位之间！" placeholder="密码6~16位之间，建议包含英文和标点符号！"
               validate="['required']"
               onblur="return validPassword();">
      </div>
      <div class="form-group">
        <input id="confirmPassword" name="user.confirmPassword" size="20" type="password" class="form-control"
               datatype="*" recheck="user.password" nullmsg="请再输入一次密码！" placeholder="请再输入一次密码！" validate="['required']">
      </div>
      <div class="distance">

      </div>
      <div class="form-group">
        <input onclick="reset()" id="btn_sub" id="signupBtn" name="signupBtn" class="btn-block btn btn-lg btn-info"
               value="确 定"/>
      </div>

    </div>
  </div>
</div>

<div class="foot clearfix">
  <p>
    <a href="https://www.easyapi.com/info/about">关于我们</a>
    <a href="https://www.easyapi.com/info/together">合作伙伴</a>
    <a href="https://www.easyapi.com/info/contact">联系我们</a>
    <a href="https://www.easyapi.com/info/donate">支持我们</a>
  </p>
  <p>Copyright © 2014～2020 上海帮趣网络技术有限公司</p>
</div>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js" type="text/javascript"></script>
<script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://static.easyapi.com/scripts/base.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/layer/2.3/layer.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/jQuery-JSONP/2.4.0/jquery.jsonp.min.js"></script>
<script type="text/javascript" src="https://static.easyapi.com/scripts/libs/Validform_v5.3.2_min.js"></script>
<script type="text/javascript">

  function checkPhone(phone) {
    if (!(/^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/.test(phone))) {
      return false;
    }
    return true
  }

  function validPassword() {
    if ($("#password").val().length < 6 || $("#password").val().length > 16) {
      layer.msg("密码范围在6~16位之间");
      return false
    }
    return true
  }

  var timer

  function sendCode() {
    if (!checkPhone($("#username").val())) {
      return layer.msg('请输入正确的手机号')
    }
    $.ajax({
      url: "https://account-api.easyapi.com/api/captcha/send",
      method: "POST",
      contentType: 'application/json',
      data: JSON.stringify({
        mobile: $("#username").val()
      }),
      success: function (data) {
        layer.msg("验证码发送成功");
      }
    });
    let btn = $("#sendCodeBtn")
    var second = 60;
    btn.attr('disabled', true).addClass('disabled');
    timer = setInterval(() => {
      second--;
      if (second == 0) {
        btn.text('获取验证码');
        btn.attr('disabled', false).removeClass('disabled');
        clearInterval(timer)
        return
      }
      btn.text(`剩余${second}秒`);
    }, 1000)
  }

  /**
   * 重置用户密码
   */
  function reset() {
    var username = $("#username").val();
    var code = $("#code").val();
    var password = $("#password").val()
    var confirmPassword = $("#confirmPassword").val()
    if (password != confirmPassword) {
      layer.msg("确认密码不一致");
      return false;
    }

    $.ajax({
      method: 'POST',
      url: 'https://account-api.easyapi.com/api/account/forget-password/reset',
      contentType: 'application/json',
      data: JSON.stringify({
        code: $("#code").val(),
        username: $("#username").val(),
        password: $("#password").val(),
        confirmPassword: $("#confirmPassword").val()
      }),
      success: function (data) {
        layer.msg(data.message, {
          icon: 1,
          time: 2000
        }, function () {
          window.location.replace('login');
        });
      },
      error: function (data) {
        layer.msg(data.message);
      }
    });
    return false;
  }
</script>
</body>

</html>
